"use strict";(self.webpackChunknescafe_restaurant=self.webpackChunknescafe_restaurant||[]).push([[198],{9198(e,s,r){r.r(s),r.d(s,{default:()=>j});var t=r(6540),a=r(6485),l=r(429),d=r(5164),n=r(892),o=r(6644),i=r(3436),c=r(165),x=r(1385),m=r(6563),p=r(7235),u=r(7133),h=r(8110),b=r(1839),g=r(888),f=r(4848);const y={pending:{color:"bg-amber-100 text-amber-700",icon:p.A,label:"Pending"},preparing:{color:"bg-blue-100 text-blue-700",icon:x.A,label:"Preparing"},ready:{color:"bg-purple-100 text-purple-700",icon:u.A,label:"Ready"},delivered:{color:"bg-green-100 text-green-700",icon:c.A,label:"Delivered"},cancelled:{color:"bg-red-100 text-red-700",icon:o.A,label:"Cancelled"}},j=()=>{const{user:e}=(0,l.A)(),[s,r]=(0,t.useState)([]),[o,x]=(0,t.useState)(!0),[p,j]=(0,t.useState)("all");(0,t.useEffect)(()=>{w();const e=a.N.channel("orders-channel").on("postgres_changes",{event:"*",schema:"public",table:"orders"},()=>{w()}).subscribe();return()=>{a.N.removeChannel(e)}},[]);const w=async()=>{try{const{data:e,error:s}=await a.N.from("orders").select("\n                    *,\n                    users!orders_user_id_fkey (name, email),\n                    order_items (*)\n                ").order("created_at",{ascending:!1});if(s)throw s;r(e)}catch(e){console.error("Error fetching orders:",e),g.Ay.error("Failed to load orders")}finally{x(!1)}},N=async(e,s)=>{try{const{error:r}=await a.N.from("orders").update({status:s}).eq("id",e);if(r)throw r;g.Ay.success(`Order marked as ${s}`)}catch(e){console.error("Error updating status:",e),g.Ay.error("Failed to update status")}},v="all"===p?s:s.filter(e=>e.status===p);return(0,f.jsxs)("div",{className:"min-h-screen bg-gray-50 p-4 md:p-8 font-sans",children:[(0,f.jsxs)("header",{className:"max-w-6xl mx-auto mb-8 flex flex-col md:flex-row md:items-center justify-between gap-4",children:[(0,f.jsxs)("div",{children:[(0,f.jsx)("h1",{className:"text-3xl font-black text-[#3E2723]",children:"Nescafe Command Center"}),(0,f.jsx)("p",{className:"text-gray-500 font-medium",children:"Manage incoming orders and live status."})]}),(0,f.jsxs)("div",{className:"flex items-center gap-3",children:[(0,f.jsxs)("button",{onClick:async()=>{if(window.confirm("⚠️ DANGER: This will delete ALL user profiles, ALL orders, and ALL order items. You must still manually delete users from the Supabase Auth tab. Proceed?"))try{x(!0);const{error:e}=await a.N.from("order_items").delete().neq("id","00000000-0000-4000-a000-000000000000");if(e)throw e;const{error:s}=await a.N.from("orders").delete().neq("id","00000000-0000-4000-a000-000000000000");if(s)throw s;const{error:r}=await a.N.from("users").delete().neq("id","00000000-0000-4000-a000-000000000000");if(r)throw r;g.Ay.success("System Reset Complete!"),w()}catch(e){console.error("Reset error:",e),g.Ay.error("Failed to reset system")}finally{x(!1)}},className:"flex items-center gap-2 bg-red-50 text-red-600 px-4 py-2 rounded-xl text-xs font-black uppercase tracking-wider hover:bg-red-100 transition-all border border-red-100",children:[(0,f.jsx)(b.A,{size:14})," System Reset"]}),(0,f.jsx)("div",{className:"flex bg-white p-1 rounded-2xl shadow-sm border border-gray-100 overflow-x-auto",children:["all","preparing","ready","delivered"].map(e=>(0,f.jsx)("button",{onClick:()=>j(e),className:"px-4 py-2 rounded-xl text-xs font-black uppercase tracking-wider transition-all whitespace-nowrap "+(p===e?"bg-[#3E2723] text-white":"text-gray-400 hover:text-[#3E2723]"),children:e},e))})]})]}),(0,f.jsx)("main",{className:"max-w-6xl mx-auto grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:o?[...Array(6)].map((e,s)=>(0,f.jsx)("div",{className:"bg-white h-64 rounded-3xl animate-pulse shadow-sm"},s)):v.length>0?(0,f.jsx)(d.N,{children:v.map(e=>(y[e.status]?.icon||m.A,(0,f.jsxs)(n.P.div,{layout:!0,initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"bg-white rounded-3xl shadow-sm border border-gray-100 overflow-hidden flex flex-col hover:shadow-md transition-shadow",children:[(0,f.jsxs)("div",{className:"p-5 border-b border-gray-50 flex justify-between items-start",children:[(0,f.jsxs)("div",{children:[(0,f.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,f.jsxs)("span",{className:"text-xs font-black text-gray-300 font-mono",children:["#",e.id.slice(0,8).toUpperCase()]}),(0,f.jsx)("span",{className:`px-2 py-0.5 rounded-full text-[10px] font-black uppercase tracking-widest ${y[e.status]?.color}`,children:e.status})]}),(0,f.jsx)("h3",{className:"font-black text-[#3E2723] text-lg",children:e.users?.name||"Anonymous"}),(0,f.jsx)("p",{className:"text-xs text-gray-400 font-medium",children:new Date(e.created_at).toLocaleTimeString()})]}),(0,f.jsx)("div",{className:"p-3 rounded-2xl "+("delivery"===e.order_mode?"bg-orange-50 text-orange-500":"bg-blue-50 text-blue-500"),children:"delivery"===e.order_mode?(0,f.jsx)(i.A,{size:24}):(0,f.jsx)(h.A,{size:24})})]}),(0,f.jsxs)("div",{className:"p-5 flex-1 space-y-4",children:[(0,f.jsx)("div",{className:"space-y-2",children:e.order_items?.map((e,s)=>(0,f.jsxs)("div",{className:"flex justify-between items-center text-sm",children:[(0,f.jsxs)("span",{className:"font-bold text-[#3E2723]",children:[(0,f.jsxs)("span",{className:"text-[#D4AF37]",children:[e.quantity,"x"]})," ",e.name]}),(0,f.jsx)("span",{className:"text-xs text-gray-400 font-medium",children:e.variant})]},s))}),"delivery"===e.order_mode&&(0,f.jsxs)("div",{className:"bg-gray-50 p-3 rounded-2xl border border-gray-100",children:[(0,f.jsx)("p",{className:"text-[10px] font-black text-gray-400 uppercase mb-1",children:"Delivery Address"}),(0,f.jsxs)("p",{className:"text-xs font-bold text-[#3E2723]",children:[e.hostel_block,", Room ",e.room_number]})]})]}),(0,f.jsxs)("div",{className:"p-4 bg-gray-50 flex gap-2",children:["preparing"===e.status&&(0,f.jsxs)("button",{onClick:()=>N(e.id,"ready"),className:"flex-1 bg-purple-600 text-white py-3 rounded-xl text-xs font-black uppercase tracking-widest flex items-center justify-center gap-2 hover:bg-purple-700 transition-all shadow-md active:scale-95",children:["Mark Ready ",(0,f.jsx)(u.A,{size:16})]}),"ready"===e.status&&(0,f.jsxs)("button",{onClick:()=>N(e.id,"delivered"),className:"flex-1 bg-green-600 text-white py-3 rounded-xl text-xs font-black uppercase tracking-widest flex items-center justify-center gap-2 hover:bg-green-700 transition-all shadow-md active:scale-95",children:["Complete ",(0,f.jsx)(c.A,{size:16})]})]})]},e.id)))}):(0,f.jsxs)("div",{className:"col-span-full py-20 bg-white rounded-[40px] border-2 border-dashed border-gray-100 text-center",children:[(0,f.jsx)(h.A,{size:48,className:"text-gray-100 mx-auto mb-4"}),(0,f.jsx)("h2",{className:"text-2xl font-black text-[#3E2723]",children:"No orders found"}),(0,f.jsx)("p",{className:"text-gray-400 font-medium",children:"It's a bit too quiet here... did the internet die?"})]})})]})}}}]);
//# sourceMappingURL=198.73fe0e25.js.map